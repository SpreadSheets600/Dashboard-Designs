<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prism.ai - JEE/NEET Advanced Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Tailwind Config for Aurora Palette -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', // Custom dark slate
                            900: '#0f172a',
                        },
                        indigo: {
                            900: '#312e81',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        /* Chosen Palette: Aurora Scheme (Deep Indigo/Slate/Black with Cyan/Purple/Teal Accents) */
        
        body {
            font-family: 'Inter', sans-serif;
            /* bg-mesh implementation */
            background: radial-gradient(circle at 0% 0%, #312e81 0%, transparent 50%), 
                        radial-gradient(circle at 100% 0%, #1e1b4b 0%, transparent 50%), 
                        radial-gradient(circle at 100% 100%, #0f172a 0%, transparent 50%), 
                        #000000;
            background-attachment: fixed;
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Functional Glassmorphism Utilities */
        .glass-base {
            background-color: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-floating {
            background-color: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .glass-panel-heavy {
            background-color: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(32px);
            -webkit-backdrop-filter: blur(32px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Hover Sheen Animation */
        .glass-sheen {
            position: relative;
            overflow: hidden;
        }
        .glass-sheen::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.1), transparent);
            transform: skewX(-25deg);
            transition: 0.5s;
            pointer-events: none;
        }
        .glass-sheen:hover::after {
            left: 200%;
            transition: 0.7s ease-in-out;
        }

        /* Ice Crack Micro-interaction */
        .ice-crack-active {
            transform: scale(0.98);
            border-color: #3b82f6; /* Blue-500 */
        }
        
        .ice-crack-correct {
            border-color: #22c55e !important; /* Green-500 */
            background-color: rgba(34, 197, 94, 0.1) !important;
        }
        
        .ice-crack-wrong {
            border-color: #ef4444 !important; /* Red-500 */
            background-color: rgba(239, 68, 68, 0.1) !important;
        }

        /* Modal Transitions */
        dialog {
            opacity: 0;
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
            transform: scale(0.95);
        }
        dialog[open] {
            opacity: 1;
            transform: scale(1);
        }
        dialog::backdrop {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }

        /* Chart Container sizing */
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            max-width: 100%;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5); 
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2); 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3); 
        }
    </style>
    
    <!-- Application Structure Plan: 
         1. Navbar: Persistent top navigation with user stats (Glass Level 1).
         2. Main Viewport: Swaps between 'Dashboard' and 'Quiz' views.
            - Dashboard: Grid of Subject Cards (Glass Level 2) with "Sheen" hover.
            - Quiz Mode: Focused container (Glass Level 2/High Opacity) for readability.
         3. Analysis Modal: Overlay for detailed Chart.js stats (Glass Level 3).
         
         Rationale: This flat hierarchy minimizes navigation clicks. The "Focus Mode" for quizzes 
         removes the dashboard clutter to aid concentration, adhering to the "Functional" aspect of the spec.
    -->
    
    <!-- Visualization & Content Choices:
         - Subject Mastery: Linear Progress bars on cards -> Quick status check.
         - Overall Performance: Radar Chart in Modal -> Comparative analysis of skills (Speed vs Accuracy vs Streak).
         - Trend Analysis: Line Chart in Modal -> Tracking progress over time.
         - Interaction: "Ice Crack" on buttons -> Immediate tactile feedback for quiz answers.
    -->

    <!-- CONFIRMATION: NO SVG graphics used (only inline standard SVG icons). NO Mermaid JS used. -->
</head>
<body class="antialiased selection:bg-cyan-500 selection:text-white">

    <!-- 3.1 The "Frosted" Navbar -->
    <nav class="fixed top-0 z-50 w-full glass-base transition-all">
        <div class="mx-auto flex h-16 max-w-7xl items-center justify-between px-4">
            <!-- Logo -->
            <div class="flex items-center gap-2 cursor-pointer" onclick="app.navigate('dashboard')">
                <div class="h-8 w-8 rounded-lg bg-gradient-to-tr from-cyan-400 to-blue-500 shadow-[0_0_15px_rgba(6,182,212,0.5)] flex items-center justify-center font-bold text-black text-xs">P</div>
                <span class="text-lg font-bold tracking-wide text-white">Prism<span class="text-cyan-400">.ai</span></span>
            </div>

            <!-- Glass Tabs (Desktop) -->
            <div class="hidden md:flex rounded-full bg-white/5 p-1 border border-white/10">
                <button onclick="app.navigate('dashboard')" id="nav-dashboard" class="rounded-full px-4 py-1.5 text-sm font-medium text-white bg-white/10 shadow-sm transition-all">Dashboard</button>
                <button onclick="app.openModal('stats_modal')" class="rounded-full px-4 py-1.5 text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 transition-all">Analysis</button>
            </div>

            <!-- User Profile & Streak -->
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2 rounded-full bg-orange-500/20 px-3 py-1 border border-orange-500/30">
                    <span class="text-orange-400 text-sm">ðŸ”¥</span>
                    <span class="text-sm font-bold text-orange-200" id="user-streak">12 Days</span>
                </div>
                <div class="relative group cursor-pointer">
                    <div class="w-9 h-9 flex items-center justify-center rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 ring ring-white/20 ring-offset-2 ring-offset-slate-900 overflow-hidden">
                        <span class="text-xs text-white font-bold">JD</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Application Container -->
    <div id="app-container" class="min-h-screen pt-24 pb-12 px-4 md:px-6 max-w-7xl mx-auto">
        
        <!-- View: Dashboard -->
        <div id="view-dashboard" class="space-y-8 animate-fade-in">
            <!-- Welcome Header -->
            <div class="space-y-2">
                <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight">Welcome back, John</h1>
                <p class="text-slate-400 max-w-2xl">Your target exam <strong>JEE Advanced</strong> is in 145 days. You have 3 pending topic reviews.</p>
            </div>

            <!-- Subject Cards Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="subject-grid">
                <!-- Cards injected via JS -->
            </div>
        </div>

        <!-- View: Quiz / Focus Mode -->
        <div id="view-quiz" class="hidden">
             <!-- 3.3 The "Focus Mode" Question Container -->
            <main class="mx-auto max-w-4xl">
                <!-- Breadcrumb Back -->
                <button onclick="app.navigate('dashboard')" class="mb-6 flex items-center gap-2 text-sm text-slate-400 hover:text-white transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    Exit Focus Mode
                </button>

                <div class="rounded-3xl glass-panel-heavy p-6 md:p-8 shadow-2xl relative overflow-hidden">
                    <!-- Subtle gradient glow for ambiance -->
                    <div class="absolute top-0 right-0 w-64 h-64 bg-cyan-500/10 blur-[100px] rounded-full pointer-events-none"></div>

                    <!-- Header -->
                    <div class="mb-6 flex items-center justify-between border-b border-white/5 pb-6 relative z-10">
                        <div class="flex flex-col">
                            <span class="text-xs font-bold uppercase tracking-wider text-cyan-400 mb-1" id="quiz-subject-tag">Physics</span>
                            <span class="text-sm font-medium text-slate-400" id="quiz-progress-text">Question 1 of 5</span>
                        </div>
                        <div class="flex items-center gap-2 text-orange-400 bg-orange-500/10 px-3 py-1 rounded-full border border-orange-500/20">
                            <svg class="h-4 w-4 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            <span class="font-mono text-lg font-bold" id="quiz-timer">00:00</span>
                        </div>
                    </div>

                    <!-- Question Text -->
                    <div class="prose prose-invert max-w-none relative z-10 mb-8">
                        <p class="text-xl md:text-2xl leading-relaxed text-slate-100 font-medium" id="quiz-question">
                            Loading Question...
                        </p>
                    </div>

                    <!-- Options Grid -->
                    <div class="grid gap-4 md:grid-cols-2 relative z-10" id="quiz-options">
                        <!-- Options injected via JS -->
                    </div>
                    
                    <!-- Feedback / Next Area -->
                    <div id="quiz-feedback" class="mt-8 hidden border-t border-white/10 pt-6">
                        <div class="flex justify-between items-center">
                            <p class="text-slate-300" id="feedback-text">Correct Answer: <span class="font-bold text-white">Option A</span></p>
                            <button onclick="app.nextQuestion()" class="px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-bold rounded-xl shadow-lg hover:shadow-cyan-500/25 transition-all transform hover:scale-105">Next Question</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>

    </div>

    <!-- 3.4 Translucent Performance Modal -->
    <dialog id="stats_modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm w-full h-full border-none">
        <div class="relative w-full max-w-4xl glass-panel-heavy rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <!-- Header with Gradient -->
            <div class="bg-gradient-to-r from-fuchsia-600 to-purple-800 p-6 flex justify-between items-start shrink-0">
                <div>
                    <h3 class="text-2xl font-bold text-white">Performance Analysis</h3>
                    <p class="text-purple-100/80 text-sm mt-1">Deep dive into your learning metrics across all subjects.</p>
                </div>
                <button onclick="app.closeModal('stats_modal')" class="text-white/50 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <!-- Body - Scrollable -->
            <div class="p-6 overflow-y-auto custom-scrollbar flex-grow">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <!-- Chart 1: Radar (Skill Balance) -->
                    <div class="flex flex-col gap-4">
                        <div class="flex items-center gap-2 mb-2">
                             <div class="w-8 h-8 rounded-lg bg-indigo-500/20 flex items-center justify-center text-indigo-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>
                             </div>
                             <h4 class="text-lg font-bold text-white">Skill Distribution</h4>
                        </div>
                        <p class="text-sm text-slate-400">Comparing your Accuracy, Speed, and Consistency against the topper average.</p>
                        
                        <div class="chart-container glass-floating rounded-xl p-4">
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>

                    <!-- Chart 2: Bar (Weak Topics) -->
                    <div class="flex flex-col gap-4">
                        <div class="flex items-center gap-2 mb-2">
                             <div class="w-8 h-8 rounded-lg bg-red-500/20 flex items-center justify-center text-red-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                             </div>
                             <h4 class="text-lg font-bold text-white">Areas for Improvement</h4>
                        </div>
                        <p class="text-sm text-slate-400">Topics with accuracy below 60%. Prioritize these for your next revision.</p>

                        <div class="chart-container glass-floating rounded-xl p-4">
                            <canvas id="barChart"></canvas>
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="col-span-1 md:col-span-2 grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                        <div class="glass-floating p-4 rounded-xl text-center">
                            <div class="text-2xl font-bold text-white">76%</div>
                            <div class="text-xs text-slate-400 uppercase tracking-wider">Avg Accuracy</div>
                        </div>
                        <div class="glass-floating p-4 rounded-xl text-center">
                            <div class="text-2xl font-bold text-cyan-400">45s</div>
                            <div class="text-xs text-slate-400 uppercase tracking-wider">Avg Time/Q</div>
                        </div>
                        <div class="glass-floating p-4 rounded-xl text-center">
                            <div class="text-2xl font-bold text-purple-400">Top 10%</div>
                            <div class="text-xs text-slate-400 uppercase tracking-wider">Percentile</div>
                        </div>
                        <div class="glass-floating p-4 rounded-xl text-center">
                            <div class="text-2xl font-bold text-emerald-400">850</div>
                            <div class="text-xs text-slate-400 uppercase tracking-wider">Q Solved</div>
                        </div>
                    </div>

                </div>
            </div>
            
            <!-- Action Bar -->
            <div class="border-t border-white/5 bg-black/20 px-6 py-4 flex justify-end gap-3 shrink-0">
                <button onclick="app.closeModal('stats_modal')" class="px-4 py-2 rounded-lg text-slate-300 hover:bg-white/10 transition-colors text-sm font-medium">Close</button>
                <button class="px-4 py-2 rounded-lg bg-gradient-to-r from-fuchsia-500 to-purple-600 text-white shadow-lg shadow-purple-500/30 text-sm font-bold hover:brightness-110 transition-all">Generate Revision Plan</button>
            </div>
        </div>
    </dialog>

    <script>
        /**
         * Prism Dashboard Application Logic
         * Handles routing, data injection, quiz logic, and chart rendering.
         */

        // --- Mock Data ---
        const MOCK_DATA = {
            user: {
                id: "u_123",
                name: "John Doe",
                streak: 12,
                xp: 4500,
                targetExam: "JEE_ADVANCED"
            },
            subjects: [
                {
                    id: "phys_01",
                    subject: "Physics",
                    topic: "Rotational Motion",
                    details: "12 topics â€¢ 450 Questions",
                    mastery: 68,
                    color: "blue",
                    gradient: "from-cyan-400 to-blue-500",
                    shadow: "rgba(59,130,246,0.5)",
                    iconPath: "M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"
                },
                {
                    id: "math_01",
                    subject: "Mathematics",
                    topic: "Integral Calculus",
                    details: "8 topics â€¢ 320 Questions",
                    mastery: 42,
                    color: "purple",
                    gradient: "from-fuchsia-400 to-purple-600",
                    shadow: "rgba(147,51,234,0.5)",
                    iconPath: "M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"
                },
                {
                    id: "chem_01",
                    subject: "Chemistry",
                    topic: "Organic Reactions",
                    details: "15 topics â€¢ 600 Questions",
                    mastery: 85,
                    color: "emerald",
                    gradient: "from-teal-300 to-emerald-500",
                    shadow: "rgba(16,185,129,0.5)",
                    iconPath: "M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"
                },
                {
                    id: "math_02",
                    subject: "Mathematics",
                    topic: "Vectors & 3D",
                    details: "5 topics â€¢ 200 Questions",
                    mastery: 15,
                    color: "purple",
                    gradient: "from-fuchsia-400 to-purple-600",
                    shadow: "rgba(147,51,234,0.5)",
                    iconPath: "M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"
                },
                {
                    id: "phys_02",
                    subject: "Physics",
                    topic: "Electromagnetism",
                    details: "10 topics â€¢ 500 Questions",
                    mastery: 92,
                    color: "blue",
                    gradient: "from-cyan-400 to-blue-500",
                    shadow: "rgba(59,130,246,0.5)",
                    iconPath: "M13 10V3L4 14h7v7l9-11h-7z"
                }
            ],
            questions: [
                {
                    id: 1,
                    text: "A particle of mass <span class='text-cyan-300 font-mono'>m</span> moves in a circular orbit of radius <span class='text-cyan-300 font-mono'>r</span> under a central potential <span class='text-cyan-300 font-mono'>V(r) = -k/r</span>. What is the total energy of the particle?",
                    options: [
                        { id: 'A', text: "-k/2r", correct: true },
                        { id: 'B', text: "-k/r", correct: false },
                        { id: 'C', text: "k/2r", correct: false },
                        { id: 'D', text: "-3k/2r", correct: false }
                    ]
                },
                {
                    id: 2,
                    text: "Which of the following represents the correct order of acidic strength?",
                    options: [
                        { id: 'A', text: "HF > HCl > HBr > HI", correct: false },
                        { id: 'B', text: "HI > HBr > HCl > HF", correct: true },
                        { id: 'C', text: "HCl > HF > HBr > HI", correct: false },
                        { id: 'D', text: "HI > HCl > HBr > HF", correct: false }
                    ]
                }
            ]
        };

        // --- Application State & Logic ---
        const app = {
            state: {
                currentView: 'dashboard',
                currentQuestionIndex: 0,
                timer: 0,
                timerInterval: null
            },

            init() {
                this.renderDashboard();
                this.updateUserStats();
                this.setupCharts();
            },

            updateUserStats() {
                document.getElementById('user-streak').innerText = `${MOCK_DATA.user.streak} Day Streak`;
            },

            // --- Navigation ---
            navigate(viewName) {
                // Handle UI Switching
                const dashboard = document.getElementById('view-dashboard');
                const quiz = document.getElementById('view-quiz');
                const navBtn = document.getElementById('nav-dashboard');

                this.state.currentView = viewName;

                if (viewName === 'dashboard') {
                    dashboard.classList.remove('hidden');
                    quiz.classList.add('hidden');
                    navBtn.classList.add('bg-white/10', 'text-white');
                    navBtn.classList.remove('text-slate-400');
                    this.stopTimer();
                } else if (viewName === 'quiz') {
                    dashboard.classList.add('hidden');
                    quiz.classList.remove('hidden');
                    navBtn.classList.remove('bg-white/10', 'text-white');
                    navBtn.classList.add('text-slate-400');
                    this.startQuiz();
                }
                
                window.scrollTo(0, 0);
            },

            // --- Dashboard Rendering ---
            renderDashboard() {
                const grid = document.getElementById('subject-grid');
                grid.innerHTML = MOCK_DATA.subjects.map(sub => `
                    <div onclick="app.navigate('quiz')" class="glass-sheen group relative overflow-hidden rounded-2xl border border-white/10 bg-white/5 p-6 backdrop-blur-lg transition-all duration-300 hover:-translate-y-1 hover:bg-white/10 hover:shadow-[0_20px_40px_-15px_rgba(0,0,0,0.5)] cursor-pointer">
                        <!-- Dynamic Glow -->
                        <div class="absolute -right-10 -top-10 h-32 w-32 rounded-full bg-${sub.color}-500/30 blur-3xl transition-all group-hover:bg-${sub.color}-400/40"></div>
                        
                        <div class="relative z-10">
                            <div class="mb-4 flex items-center justify-between">
                                <div class="rounded-lg bg-${sub.color}-500/20 p-2 text-${sub.color}-300 ring-1 ring-inset ring-${sub.color}-400/30">
                                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${sub.iconPath}" /></svg>
                                </div>
                                <span class="rounded-full bg-white/5 px-2 py-1 text-xs font-semibold text-white border border-white/10">${sub.subject}</span>
                            </div>
                            
                            <h3 class="text-xl font-bold text-white group-hover:text-${sub.color}-200 transition-colors">${sub.topic}</h3>
                            <p class="mt-2 text-sm text-slate-300">${sub.details}</p>
                            
                            <!-- Glass Progress Bar -->
                            <div class="mt-6">
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-slate-400">Mastery</span>
                                    <span class="text-white font-bold">${sub.mastery}%</span>
                                </div>
                                <div class="h-2 w-full overflow-hidden rounded-full bg-slate-700/50">
                                    <div class="h-full rounded-full bg-gradient-to-r ${sub.gradient}" style="width: ${sub.mastery}%; box-shadow: 0 0 10px ${sub.shadow}"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            // --- Quiz Logic ---
            startQuiz() {
                this.state.currentQuestionIndex = 0;
                this.state.timer = 0;
                this.renderQuestion();
                this.startTimer();
            },

            startTimer() {
                clearInterval(this.state.timerInterval);
                this.state.timerInterval = setInterval(() => {
                    this.state.timer++;
                    const m = Math.floor(this.state.timer / 60).toString().padStart(2, '0');
                    const s = (this.state.timer % 60).toString().padStart(2, '0');
                    document.getElementById('quiz-timer').innerText = `${m}:${s}`;
                }, 1000);
            },

            stopTimer() {
                clearInterval(this.state.timerInterval);
            },

            renderQuestion() {
                const q = MOCK_DATA.questions[this.state.currentQuestionIndex];
                if (!q) return;

                document.getElementById('quiz-progress-text').innerText = `Question ${this.state.currentQuestionIndex + 1} of ${MOCK_DATA.questions.length}`;
                document.getElementById('quiz-question').innerHTML = q.text;
                document.getElementById('quiz-feedback').classList.add('hidden');

                const optionsContainer = document.getElementById('quiz-options');
                optionsContainer.innerHTML = q.options.map(opt => `
                    <button onclick="app.selectOption(this, ${opt.correct})" class="group relative flex items-center gap-4 rounded-xl border border-white/10 bg-white/5 p-4 text-left transition-all hover:bg-white/10 hover:border-blue-400/50 focus:outline-none w-full">
                        <span class="flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-white/10 font-bold text-slate-300 group-hover:bg-blue-500 group-hover:text-white transition-colors">${opt.id}</span>
                        <span class="text-slate-200">${opt.text}</span>
                    </button>
                `).join('');
            },

            selectOption(btn, isCorrect) {
                // Ice Crack Effect
                btn.classList.add('ice-crack-active'); // Scale down
                
                setTimeout(() => {
                    btn.classList.remove('ice-crack-active');
                    
                    // Visual feedback
                    if (isCorrect) {
                        btn.classList.add('ice-crack-correct');
                    } else {
                        btn.classList.add('ice-crack-wrong');
                    }
                    
                    // Show feedback panel
                    document.getElementById('quiz-feedback').classList.remove('hidden');
                }, 150); // Delay to feel the "snap"
            },

            nextQuestion() {
                this.state.currentQuestionIndex++;
                if (this.state.currentQuestionIndex >= MOCK_DATA.questions.length) {
                    alert("Module Complete! Returning to Dashboard.");
                    this.navigate('dashboard');
                } else {
                    this.renderQuestion();
                }
            },

            // --- Modal & Charts ---
            openModal(id) {
                const modal = document.getElementById(id);
                modal.showModal();
                // Re-render charts to ensure sizing is correct in modal
                if (window.radarChartInstance) window.radarChartInstance.resize();
                if (window.barChartInstance) window.barChartInstance.resize();
            },

            closeModal(id) {
                document.getElementById(id).close();
            },

            setupCharts() {
                // Common Chart Options for Dark Glass Theme
                const commonOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#cbd5e1' } }
                    },
                    scales: {
                        r: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
                            pointLabels: { color: '#cbd5e1' }
                        },
                        x: { ticks: { color: '#cbd5e1' }, grid: { display: false } },
                        y: { ticks: { color: '#cbd5e1' }, grid: { color: 'rgba(255, 255, 255, 0.05)' } }
                    }
                };

                // Radar Chart
                const radarCtx = document.getElementById('radarChart').getContext('2d');
                window.radarChartInstance = new Chart(radarCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Mechanics', 'Organic', 'Calculus', 'Optics', 'Physical Chem'],
                        datasets: [{
                            label: 'Your Mastery',
                            data: [85, 45, 70, 60, 90],
                            backgroundColor: 'rgba(6, 182, 212, 0.2)', // Cyan-500/20
                            borderColor: '#06b6d4',
                            pointBackgroundColor: '#fff',
                            borderWidth: 2
                        }, {
                            label: 'Topper Avg',
                            data: [90, 85, 80, 85, 95],
                            backgroundColor: 'transparent',
                            borderColor: 'rgba(148, 163, 184, 0.5)', // Slate-400
                            borderDash: [5, 5],
                            borderWidth: 1
                        }]
                    },
                    options: { ...commonOptions, scales: { ...commonOptions.scales, x: undefined, y: undefined } }
                });

                // Bar Chart
                const barCtx = document.getElementById('barChart').getContext('2d');
                window.barChartInstance = new Chart(barCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Rotational', 'Vectors', 'Equilibrium', 'Waves'],
                        datasets: [{
                            label: 'Accuracy %',
                            data: [45, 55, 30, 58],
                            backgroundColor: [
                                'rgba(239, 68, 68, 0.5)', // Red (Critical)
                                'rgba(234, 179, 8, 0.5)', // Yellow (Warning)
                                'rgba(239, 68, 68, 0.5)',
                                'rgba(234, 179, 8, 0.5)'
                            ],
                            borderColor: [
                                '#ef4444',
                                '#eab308',
                                '#ef4444',
                                '#eab308'
                            ],
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        ...commonOptions,
                        scales: {
                            ...commonOptions.scales,
                            r: undefined
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
        };

        // Initialize App
        window.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

    </script>
</body>
</html>
